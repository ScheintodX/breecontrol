export default function( config ) {

	function check( script ){
		Assert.isObject( "script", script );
		Assert.isArray( "script.steps", script.steps );

		script.steps.forEach( (e,i) => {

			Assert.present( `step{i}`, e );
			Assert.present( `step{i}.name`, e.name );
			Assert.present( `step{i}.rate`, e.rate );
			Assert.present( `step{i}.heat`, e.heat );
		} );
	}

	function prepare( script ){

		var found = false;
		var steps = script.steps
		script.split = -1;

		for( var i=0; i<steps.length; i++ ){
			var step = steps[i];
			if( step.rate < 0 ){
				script.split = i;
				break;
			}
		}

		if( script.split < 0 ) {
			throw new Error( "No Split found" );
		}

	}

	// Calculate the rate depending on the Temperature
	// script: Script to use
	// heating: true: heating, false: cooling
	// T: current temperature
	function stepfor( script, heating, T ){

		var i;
		if( heating ){

			for( i=0; i<script.split; i++ ){
				step = script.steps[ i ];
				if( step.heat > T ) return step;
			}
			return false;

		} else {

			for( i=script.split; i<script.steps.length; i++ ){
				step = script.steps[ i ];
				if( step.heat < T ) return step;
			}
			return false;
		}
	}

	function power2fac( kW, T ){

		var p_max = P_MAX / HR( T );

		return kW / p_max;
	}

	function powerFor( rate, T ){

		var p_heat = Q_KILN * rate,
			p_loss = P_LOSS * T
			;

		return p_heat + p_loss;
	}

	return {

	}

}
